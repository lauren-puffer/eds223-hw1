---
title: "Homework 1 - EDS 223"
author: "Lauren Puffer"
format: html
editor: visual
embed-resources: true
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---

## Introduction

The basis of this analysis is to better understand...

## Load Packages

For this analysis, we will be using the 'tmap' package to generate maps with data pulled from the 'Environmental Justice Screening and Mapping Tool.' We will also be using 'here' and 'tidyverse' for file management and workflow optimization.

```{r}
library(tmap)
library(here)
library(tidyverse)
library(sf) # allows us to bring in shape files for mapping
library(stars) # for raster and vector data
library(tigris) # for bringing in map of Arizona and counties
library(viridisLite) # colorblind friendly palettes
```

## Bring in EJ Screen data

```{r}
# make sure you are downloading shape files from 'tigris'
options(tigris_class = "sf")

# bring in shape files of US states
us_states <- states(class = "sf")

# get the geopackage of Arizona
ca_shape <- us_states[us_states$STUSPS == "CA", ]

# bring in shape file of Arizona counties 
ca_counties <- counties(state = "CA")

# bring in census tracts for Arizona
ca_tracts <- tracts(state = "CA")

# bring in just Maricopa county
sanjoaquin_shape <- ca_counties |>
  filter(NAME == "San Joaquin")

# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

# filter for data from Arizona
california <- ejscreen |>
  filter(ST_ABBREV == "CA") 

# get data from Maricopa county
sanjoaquin <- california |>
  filter(CNTY_NAME %in% c("San Joaquin County"))

```

## Map of Demographic Index & PM 2.5

In order to explore the relationship between demographic index (an aggregated score of poverty and minority status) and PM 2.5.

```{r}
# make maps static 
tmap_mode("plot")

# make a map of Demographic Index in San Joaquin County
sanjoaquin_demo <- tm_shape(sanjoaquin_shape, bbox = sanjoaquin) +
      tm_polygons()+
    tm_shape(sanjoaquin)+
      tm_polygons(fill = "B_DEMOGIDX_2",
                  lwd = 0.5,
                  fill.scale = tm_scale(values = "viridis"),
                  fill.legend = tm_legend(title = "Demographic Index"))+
    tm_compass(type = "arrow",
               position = c("left", "top"),
               size = 2) +
    tm_scalebar()+
      tm_title("San Joaquin County")
    

# make a map of PM 25 in San Joaquin County
sanjoaquin_pm25 <- tm_shape(sanjoaquin_shape, bbox = sanjoaquin) +
      tm_polygons()+
    tm_shape(sanjoaquin)+
      tm_polygons(fill = "PM25",
                  lwd = 0.5,
                  fill.scale = tm_scale(values = "magma"),
                  fill.legend = tm_legend(title = "PM 2.5"))+
tm_scalebar(position = c("right", "bottom")) +
        tm_title(" ")

# arrange side-by-side
tmap_arrange(sanjoaquin_demo, sanjoaquin_pm25, ncol = 2)
```
