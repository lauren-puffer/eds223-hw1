---
title: "Homework 1 - EDS 223"
author: "Lauren Puffer"
format: html
editor: visual
embed-resources: true
code-fold: show
execute: 
  warning: false
  message: false
toc: TRUE
theme: journal
---

## Introduction

The purpose of this analysis is to get a visual understanding of the relationship between air pollution and socioeconomic status in San Joaquin County in California.

## Load Packages

For this analysis, we will be using the 'tmap' package to generate maps with data pulled from the 'Environmental Justice Screening and Mapping Tool.' We will also be using 'here' and 'tidyverse' for file management and workflow optimization.

```{r}
library(tmap)
library(here)
library(tidyverse)
library(sf) # allows us to bring in shape files for mapping
library(stars) # for raster and vector data
library(tigris) # for bringing in map of Arizona and counties
library(viridisLite) # colorblind friendly palettes
```

## Shape files & EJ Screen data

In order to properly display our data, we must first bring in the shape files of the areas we wish to look at.

```{r}
# make sure you are downloading shape files from 'tigris'
options(tigris_class = "sf")

# bring in shape file of California counties 
ca_counties <- counties(state = "CA")

# bring in census tracts for California
ca_tracts <- tracts(state = "CA")

# bring in just San Joaquin county
sanjoaquin_shape <- ca_counties |>
  filter(NAME == "San Joaquin")

# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- st_read(here::here("data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

# filter for data from California
california <- ejscreen |>
  filter(ST_ABBREV == "CA") 

# filter data from San Joaquin county
sanjoaquin <- california |>
  filter(CNTY_NAME %in% c("San Joaquin County"))

```

## Map of Demographic Index & PM 2.5

In order to explore the relationship between demographic index (an aggregated score of poverty and minority status) and PM 2.5. The demographic index combines the minority and poverty statues of a population to create one index.

```{r}
# make maps static 
tmap_mode("plot")

# make a map of Demographic Index in San Joaquin County
sanjoaquin_demo <- tm_shape(sanjoaquin_shape, bbox = sanjoaquin) +
      tm_polygons()+
    tm_shape(sanjoaquin)+
      tm_polygons(fill = "B_DEMOGIDX_2",
                  lwd = 0.5,
                  fill.scale = tm_scale(values = "viridis"),
                  fill.legend = tm_legend(title = "Demographic Index"))+
    tm_compass(type = "arrow",
               position = c("left", "top"),
               size = 2) +
    tm_scalebar()+
      tm_title("San Joaquin County")
    

# make a map of PM 25 in San Joaquin County
sanjoaquin_pm25 <- tm_shape(sanjoaquin_shape, bbox = sanjoaquin) +
      tm_polygons()+
    tm_shape(sanjoaquin)+
      tm_polygons(fill = "PM25",
                  lwd = 0.5,
                  fill.scale = tm_scale(values = "magma"),
                  fill.legend = tm_legend(title = "PM 2.5"))+
tm_scalebar(position = c("right", "bottom")) +
        tm_title(" ")

# arrange side-by-side
tmap_arrange(sanjoaquin_demo, sanjoaquin_pm25, ncol = 2)
```

## Discussion 

The following maps can be compared to show a possible correlation between socioeconomic status (demographic index) and air pollution from PM 2.5. PM 2.5 concentrations seem to be focused in the southern end of San Joaquin County.
